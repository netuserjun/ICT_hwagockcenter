IP 주소 대역

A클래스 0~127.x.x.x   	사설은 10.x.x.x
B클래스 128~191.x.x.x 	사설은 172.16~31.x.x
C클래스 192~223.x.x.x 	사설은 192.168.x.x
D클래스 224~239.x.x.x (멀티캐스트용 주소)
E클래스 240~255.x.x.x




0. dynamic routing protocol 동작방법
	
	라우팅 프로세스 작동 	router [protocol] 
	전달할 네트워크를 선언	network x.x.x.x
	튜닝 : metric,  summary 주소 요약

1. RIP 라우팅 프로토콜의 특징 
	RIP : Routing Information Protocol
	작동방법 : 프로세스 켜서, 전달할 network 주소를 선언.
	metric : 라우터 개수(hop count) - 최대 15  (BW 모름)
	Administrative Distance value : 120
	장점 : 설정하기 쉬움.
	단점 : rip timer 30sec, 멀수록 시간차 생김 (convergense time이 길다.)
	        ripv1 classful : subnetmask 정보를 주고받지 못함. -> subnetting 주소디자인에서는 문제발생.
	        ripv2 classless: subnetmask 정보를 주고받을 수 있음.

	{ network , metric | RIP | UDP 520 | IP | ethernet }
	rip v1 ip.dst 255.255.255.255
 	rip v2 ip.dst  224.0.0.9

2. 거리벡터 방식의 루팅을 위한 기술들 : rip, eigrp, bgp
	maximum hop count
	split horizon : 네트워크정보를 주거나 받을 때 중복되지 않음.
	route posioning : 네트워크가 다운되면 다른 라우터에 알림 (metric=16)
	posion reverse : 라우트 포이즈닝에 대한 답변
	trigger update : 네트워크 변화가 생기는 즉시 알림. (ripv2)

3. OSPF 라우팅 프로토콜 특징
	RIP의 단점 -> OSPF  보완
	    metric 오직 hop만 봄. BW 모름.  	-> OSPF : 계산된 BW = cost
	    hop최대 15개			-> OSPF : 255개 - 하나의 area (200개 넘으로 area나누어야함)
	    30초마다 업데이트함		-> link state상태 확인해서 변화 즉시 전달함.
	metric : cost (BW)
	Administrative Distance value : 110
	Bandwidth은 낮으나 네트워크 정보를 서로 주고받아야 해서 
		적게 주고 받기 위해 적용된 것들 : 
		대그룹-소그룹 , AS - area,  
		네트워크 정보를 DR(반장), BDR(부반장)을 통해 전달함.


스위치에 IP할당하기.
	스위치는 물리적인 interface에 IP를 할당하지 못함.
	가상의 인터페이스 (BVI)에 IP주소를 할당함. (interface vlan 1)
	공장에서 나올때 부터 vlan 1이 부여 되어 있으며
	모든 인터페이스가 vlan 1에 속해 져 있습니다. #show vlan 1
	en
	show ip int brief
		vlan 1
	conf t
	int vlan 1 (가상의 스위치 인터페이스)
	  ip address 192.168.1.253 255.255.255.0
	  no shutdown
	  exit
 	 ip default-gateway 192.168.1.254 (다른네트워크를 가고자할때)
	end
	-> IP를 할당하여 원격 접속하고나, ping test가 가능함.


en
show ip route connected
	C 192.168.1.0/24
	C 192.168.2.0/24
conf t
router ospf 10 (process ID)  - ospf 10 프로세스 작동
  network  [network 주소]  [wildcard또는 subnetmask]  area  [areaID]
  network 192.168.1.0  255.255.255.0  area 0
                             0.0.0.255
  network 192.168.2.0  255.255.255.0  area 0
end
show run  입력한 명령어 확인
show ip ospf int fa0/1  해당 인터페이스의 OSPF 정보 확인 : cost , network type, 등
show ip ospf neighbor  ospf주고받을 수 있는 이웃한 라우터 목록
show ip ospf database   ospf 토폴로지 정보
show ip route  라우팅 테이블 확인 (3개의 라우터에 5개 Network 확인)
show ip protocols  ospf 속성 정보 확인

  
network 192.168.1.0  192.168.2.0   -> area 0
network 192.168.3.0  192.168.4.0  192.168.5.0  -> area 100

Hwagok_R
00:29:18: %OSPF-5-ADJCHG: Process 10, Nbr 192.168.4.1 on FastEthernet0/1 from LOADING to FULL, Loading Done
Kkachisan_R
00:29:18: %OSPF-5-ADJCHG: Process 10, Nbr 192.168.2.1 on FastEthernet1/0 from LOADING to FULL, Loading Done
00:31:03: %OSPF-5-ADJCHG: Process 10, Nbr 192.168.5.254 on FastEthernet1/1 from LOADING to FULL, Loading Done
sinjeong_R
00:31:03: %OSPF-5-ADJCHG: Process 10, Nbr 192.168.4.1 on FastEthernet0/1 from LOADING to FULL, Loading Done

각 라우터의 RouterID, 각 라우터 라우팅 테이블에 code 무엇인지 확인.


ABR  area border router  : area 경계에 있는 라우터 , 2개 이상의 area를 가지고 있는 라우터
	-> 라우팅 테이블에 O IA

ASBR  autonomous system boundry Router    AS=대그룹=OSPF


defaule route를 ospf로 전달하기
Hwagok_R 에서 static으로 defualt route를 등록
   conf t
   int loopback 0
      ip  address 1.1.1.1  255.255.255.255
      no shutdown
    exit
   ip route   0.0.0.0   0.0.0.0  loopback 0    ->  s* 0.0.0.0/0
   router ospf 10
       default-information originate      라우팅 테이블에 있는 default route를 OSPF로 전달하기.
end
Kkachisan_R, sinjeong_R에서 라우팅 테이블확인   O* 0.0.0.0/0
   

static -> rip (hop)  -> OSPF (hop 내에서 BW) -> EIGRP (hop 내에서 BW+delay) -> BGP



라우터의 라우팅 테이블정보에 따른 스위칭 방법
	-process switching : 패킷의 목적지 주소와 라우팅 테이블과 비교해서 전달할 인터페이스를 결정
	-fast switching : 처음 한 번만 라우팅 테이블과 비교해서 찾고 cache에 기억을 해놓음. 같은 주소의 패킷이 오면 저장된 정보를 참조하여 더빨리 전달함.
	-cef (cisco) : 처음부터 저장 해놓음.

패킷의 목적지 주소와 라우팅 테이블과 비교해서 전달할 인터페이스를 결정
subnetmask longest match

 라우팅 테이블
	10.0.0.0 /8  [ / ] via R1
	10.0.0.0 /16  [ / ] via R2
	10.0.0.0 /24  [ / ] via R3
	10.10.10.0/24 [ / ] via R4
	* 0.0.0.0 /0   via R5

(1) dst. 10.1.1.1  -> R1
(2) dst. 10.0.0.10 -> R3
(3) dst. 10.0.100.100 -> R2
(4) dst.  1.1.1.1  -> R5

--------------------------------------------------------
스위치  : 브릿지 기능, STP 스패닝 트리 프로토콜


pc -> switch 프레임 전달 
  프레임의 src 주소, 전달된 인터페이스 정보를 mac addres table 기록(학습) learning
프레임의 dst주소를 mac address table에서 찾아서 해당 인터페이스에만 전달함 forwarding
나머지 인터페이스에는 전달이 안됨. filtering
목적지주소가 모르는 경우, multicast/broadcast address 모두에게 전달함 flooding 
시간이 지나서 통신을 하지않으면 삭제 함 againg

스위치는 스위치 자체에 mac 주소가 있음 (식별할 때 사용)
vlan 1 이 생성되어 있음. 
모든 인터페이스가 vlan 1에 속해져 있음 .

P302 STP  spanning-tree protocol  스패닝 트리 프로토콜
STP 프레임을 주고받아서 토폴로지 구성
	Root 스위치(브릿지) 선출 
	Root 스위치 포트 : designated port 2초에 한번 씩 프레임 전송
	나머지 스위치 : root port (root 빠른 포트) 선출
	하나의 세그먼트 당   하나의 designated port 선출
	나머지 다 막음 blookding


스위치 비교 : Swtich ID  = switch priority + MAC Address
			0x8000
			32768

show version   -> Base ethernet MAC Address       : 0007.ECE6.0748
show spanning-tree
해서 mac주소 확인

stp port rule
	designated port 지정된 포트 (stp 프레임을 전송하는 포트)
	root  prot
	alertnated port 대체하는 포트 (blocking상태)

Port ID : Port priority + Port number
	128               번호

BLK  ->  LSN  ->  LRN  -> FWD
20sec	15sec	15sec  	(50sec 소요)

LSN  ->  LRN  -> FWD
15sec	15sec  	(30sec 소요)

-> RSTP alertnated port 전환 시간차를 줄여줌. 

en
conf t
spanning-tree mode rapid-pvst
end
show spanning-tree

Switch#show spanning-tree 
VLAN0001
  Spanning tree enabled protocol rstp


p285
port-security : access swtich의 interface에 설정하는 보안 정책
en
conf t
int fa0/3
 switchport port-security	보안정책 활성화
 switchport port-security maximum 2  (2개까지 학습)
 switchport port-security mac-address stikcy (학습->명령어로)
 switchport port-security mac-address [macaddress] - 거의안씀
end

Switch#show port-security int fa0/3
Port Security              : Disabled
Port Status                : Secure-down
Violation Mode             : Shutdown (어겼을경우action)
Aging Time                 : 0 mins
Aging Type                 : Absolute
SecureStatic Address Aging : Disabled
Maximum MAC Addresses      : 1
Total MAC Addresses        : 0
Configured MAC Addresses   : 0
Sticky MAC Addresses       : 0
Last Source Address:Vlan   : 0000.0000.0000:0
Security Violation Count   : 0
Switch#

sh run
!
interface FastEthernet0/3
 switchport mode access
 switchport port-security
 switchport port-security maximum 2
 switchport port-security mac-address sticky 
 switchport port-security mac-address sticky 0002.1684.D621
 spanning-tree portfast
!


Switch#show po
Switch#show port-security int fa0/3
Port Security              : Enabled
Port Status                : Secure-up
Violation Mode             : Shutdown
Aging Time                 : 0 mins
Aging Type                 : Absolute
SecureStatic Address Aging : Disabled
Maximum MAC Addresses      : 2
Total MAC Addresses        : 2
Configured MAC Addresses   : 0
Sticky MAC Addresses       : 2
Last Source Address:Vlan   : 0002.1684.D622:1
Security Violation Count   : 0

Switch#
Switch#show mac-address-table 
          Mac Address Table
-------------------------------------------

Vlan    Mac Address       Type        Ports
----    -----------       --------    -----

   1    0002.1684.d621    STATIC      Fa0/3
   1    0002.1684.d622    STATIC      Fa0/3
   1    0030.f256.9302    DYNAMIC     Fa0/2
   1    0060.5c89.6401    DYNAMIC     Fa0/1
Switch#

pc에서 세번째 mac주소 변경
Switch#show port-security int fa0/3
Port Security              : Enabled
Port Status                : Secure-shutdown
Violation Mode             : Shutdown
Aging Time                 : 0 mins
Aging Type                 : Absolute
SecureStatic Address Aging : Disabled
Maximum MAC Addresses      : 2
Total MAC Addresses        : 2
Configured MAC Addresses   : 0
Sticky MAC Addresses       : 2
Last Source Address:Vlan   : 0002.1684.D623:1
Security Violation Count   : 1


정책에 위배된 원인을 제거(허용된mac주소로 변경) -> shutdown -> no shutdown


 switchport port-security violation ?
				shutdown (비활성화)
				protect (보호-현상태유지)
				restrict (로그전송)

!
interface FastEthernet0/3
 switchport mode access
 switchport port-security
 switchport port-security maximum 2
 switchport port-security mac-address sticky 
 switchport port-security violation protect
 spanning-tree portfast
!

Switch#show port-security int fa0/3
Port Security              : Enabled
Port Status                : Secure-up
Violation Mode             : Protect
Aging Time                 : 0 mins
Aging Type                 : Absolute
SecureStatic Address Aging : Disabled
Maximum MAC Addresses      : 2
Total MAC Addresses        : 2
Configured MAC Addresses   : 0
Sticky MAC Addresses       : 2
Last Source Address:Vlan   : 0002.1684.D622:1
Security Violation Count   : 0

Switch#

오늘의 정리
1. OSPF 특징
2. STP 프로토콜 : 무엇인지, 왜사용하는지, 어떻게 동작하는지, 단점, 보완
3. Port security

IEEE 802.3 ethernet
IEEE 802.1d STP
IEEE 802.1w RSTP






